<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios@0.20.0/dist/axios.min.js"></script>
    <title>Document</title>
</head>
<body>
    <input id="email">
    <input id="password">
    <button id="btn">go</button>
    <button id="test">test</button>
    <button id="deco">déconnecte</button>
   
   
    <script>

        document.getElementById("btn").addEventListener("click", login)

        function login() { 
            let email = document.getElementById("email").value
            let password = document.getElementById("password").value
            axios.post("http://localhost:8092/user/login", { email:email , password: password})
                .then( (response) => {
                    console.log(response.data)
                    localStorage.setItem('token',response.data)
                    // le token c'est trois parties sep par des .
                    // je decoupe pr obteni rla deuxieme qui est payload
                    var payload = response.data.split('.')[1]
                    // payload est la 3eme partie encodée en base64
                    // contenant date d'exp, date de créa et le user (avec le mdp, mais pas bonne pratique)
                    var infos = JSON.parse(window.atob(payload))
                    console.log(infos)
                })
        }

        document.getElementById("test").addEventListener("click", test)

        function test(){
            var tokenFromLocalStorage = localStorage.getItem("token")
            var config = {}
            config.headers = {"Authorization" : 'Bearer ' + tokenFromLocalStorage}
            console.log(config)
            axios.get("http://localhost:8092/api/orders", config)
                    .then( response => {
                        console.log(response.data)
                    })

        }

        document.getElementById("deco").addEventListener("click", deconnecte)
        function deconnecte(){
            localStorage.removeItem('token')

        }

    </script>

</body>
</html>